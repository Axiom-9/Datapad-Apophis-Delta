<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DataPad – Apophis Delta</title>
  <style>
    :root{
      --bg:#05070a;
      --panel:#071017;
      --cyan:#67f2ff;
      --cyan2:#2fd3e6;
      --muted:#0f2c33;
      --line:rgba(103,242,255,.22);
      --line2:rgba(103,242,255,.10);
      --warn:#ffcc66;
      --ok:#7CFFB2;
      --bad:#ff6b6b;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background: radial-gradient(1200px 700px at 50% 20%, rgba(47,211,230,.08), transparent 55%),
                  radial-gradient(900px 500px at 30% 75%, rgba(103,242,255,.06), transparent 55%),
                  var(--bg);
      color: var(--cyan);
      font-family: var(--mono);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    .pad{
      /* Always landscape (Pad im Querformat) */
      width:min(1200px, 100%);
      aspect-ratio: 4.3/3;
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)),
                  linear-gradient(145deg, #101720, #0a0f14);
      border-radius: 18px;
      position:relative;
      box-shadow: 0 18px 60px rgba(0,0,0,.65);
      overflow:hidden;
      border:1px solid rgba(103,242,255,.12);
    }

    /* Landscape-first spacing */
    body{ padding:14px; }
    .screen{ inset:18px; }
    .top{ padding:12px 14px 8px 14px; }
    .content{ padding:14px; gap:10px; height: calc(100% - 56px); overflow:auto; }

    /* Per-view overrides */
    .content.noScroll{ overflow:hidden; }
    .content.compact .panel{ padding:10px; }
    .content.compact .divider{ margin:6px 0; }
    .content.compact .hint{ margin-top:2px; }
    .title{ font-size:16px; }
    .panel{ padding:12px; }
    .btn{ padding:10px 12px; }
    .key{ padding:12px 0; }
    .kbd{ max-width: 420px; }
    .bezel{
      position:absolute; inset:10px;
      border-radius: 14px;
      border:1px solid rgba(103,242,255,.10);
      box-shadow: inset 0 0 0 2px rgba(0,0,0,.35);
      pointer-events:none;
    }
    .bezel:before{
      content:"";
      position:absolute; inset:0;
      border-radius: 14px;
      background:
        linear-gradient(90deg, transparent, rgba(103,242,255,.08), transparent),
        repeating-linear-gradient(0deg, rgba(255,255,255,.02) 0, rgba(255,255,255,.02) 1px, transparent 1px, transparent 6px);
      opacity:.22;
      mix-blend-mode: screen;
      filter: blur(.2px);
    }

    .screen{
      position:absolute; inset:24px;
      border-radius: 12px;
      background:
        radial-gradient(900px 600px at 35% 15%, rgba(103,242,255,.10), transparent 60%),
        linear-gradient(180deg, rgba(7,16,23,.95), rgba(4,8,12,.98));
      border:1px solid rgba(103,242,255,.18);
      overflow:hidden;
    }

    .screen:before{
      content:"";
      position:absolute; inset:0;
      background:
        repeating-linear-gradient(0deg, rgba(255,255,255,.03) 0, rgba(255,255,255,.03) 1px, transparent 1px, transparent 6px),
        radial-gradient(400px 200px at 70% 15%, rgba(103,242,255,.08), transparent 60%);
      opacity:.25;
      pointer-events:none;
    }

    .noise{
      position:absolute; inset:-40px;
      background-image: url('data:image/svg+xml;utf8,\
        <svg xmlns="http://www.w3.org/2000/svg" width="120" height="120">\
        <filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter>\
        <rect width="120" height="120" filter="url(%23n)" opacity="0.35"/>\
        </svg>');
      opacity:.08;
      mix-blend-mode: screen;
      animation: drift 8s linear infinite;
      pointer-events:none;
    }
    @keyframes drift{ 0%{transform:translate3d(0,0,0)} 100%{transform:translate3d(-40px,20px,0)} }

    .glitchOverlay{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:0;
      background:
        linear-gradient(90deg, transparent, rgba(103,242,255,.18), transparent),
        repeating-linear-gradient(0deg, rgba(255,255,255,.06) 0, rgba(255,255,255,.06) 1px, transparent 1px, transparent 5px);
      mix-blend-mode: screen;
    }
    .glitchOn .glitchOverlay{ opacity:.35; animation: glitchFlicker 2.4s infinite; }
    @keyframes glitchFlicker{
      0%, 100%{ transform:translate(0,0); filter:blur(0px) }
      10%{ transform:translate(2px,-1px) }
      11%{ transform:translate(-6px,0px) }
      12%{ transform:translate(4px,2px); filter:blur(.4px) }
      40%{ transform:translate(0,0); filter:blur(0px) }
      55%{ transform:translate(-2px,1px) }
      56%{ transform:translate(8px,-2px) }
      57%{ transform:translate(0,0) }
    }

    .top{
      position:relative;
      padding:16px 18px 10px 18px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
    }
    .title{
      font-weight:800;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:18px;
    }
    .sub{
      font-family:var(--sans);
      font-size:12px;
      opacity:.85;
      color:rgba(103,242,255,.9);
    }
    .status{ text-align:right; font-size:12px; opacity:.9; }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      background: rgba(7,16,23,.55);
      font-size:12px;
      white-space:nowrap;
    }
    .dot{
      width:8px;height:8px;border-radius:50%;
      background:var(--ok);
      box-shadow:0 0 14px rgba(124,255,178,.65);
    }

    .content{
      position:relative;
      height: calc(100% - 62px);
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .panel{
      border:1px solid var(--line);
      background: rgba(7,16,23,.55);
      border-radius: 12px;
      padding:14px;
    }

    .row{display:flex; gap:14px; align-items:stretch;}
    .col{flex:1; min-width:0;}

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:12px 14px;
      width:100%;
      border-radius: 12px;
      border:1px solid rgba(103,242,255,.35);
      background: linear-gradient(180deg, rgba(103,242,255,.12), rgba(103,242,255,.03));
      color: var(--cyan);
      cursor:pointer;
      font-family: var(--mono);
      font-weight:700;
      letter-spacing:.04em;
      transition: transform .06s ease, border-color .2s ease, background .2s ease;
      user-select:none;
    }
    .btn:hover{ border-color: rgba(103,242,255,.55); }
    .btn:active{ transform: translateY(1px); }
    .btn.secondary{
      background: rgba(7,16,23,.45);
      border-color: rgba(103,242,255,.22);
      font-weight:600;
    }

    .grid{ display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; }
    .grid2{ display:grid; grid-template-columns: repeat(2, 1fr); gap:10px; }

    /* Emergency / alert styles */
    .alertBtn{
      border-color: rgba(255,107,107,.55) !important;
      background: linear-gradient(180deg, rgba(255,107,107,.18), rgba(255,107,107,.05)) !important;
      color: #ffd6d6;
      position: relative;
      overflow: hidden;
    }
    .alertBtn:before{
      content:"";
      position:absolute; inset:-40px;
      background: radial-gradient(240px 120px at 30% 50%, rgba(255,107,107,.35), transparent 60%);
      opacity:.8;
      animation: alertSweep 1.8s linear infinite;
      pointer-events:none;
    }
    @keyframes alertSweep{ 0%{transform:translateX(-25%)} 100%{transform:translateX(25%)} }

    .alertTag{
      display:inline-block;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(255,107,107,.55);
      background: rgba(255,107,107,.12);
      color:#ffd6d6;
      font-weight:800;
      letter-spacing:.06em;
      margin-left:8px;
      animation: alertBlink 1.2s steps(2, end) infinite;
    }
    @keyframes alertBlink{ 50%{ opacity:.35 } }

    .kbd{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      max-width: 360px;
      margin: 0 auto;
    }
    .key{
      padding:14px 0;
      border-radius: 12px;
      border:1px solid rgba(103,242,255,.25);
      background: rgba(7,16,23,.45);
      text-align:center;
      font-weight:800;
      font-size:16px;
      cursor:pointer;
      transition: border-color .2s ease, transform .06s ease;
      user-select:none;
    }
    .key:hover{ border-color: rgba(103,242,255,.55); }
    .key:active{ transform: translateY(1px); }

    .pinbox{ display:flex; justify-content:center; gap:8px; margin-top:6px; }
    .pinDot{
      width:14px; height:14px; border-radius:4px;
      border:1px solid rgba(103,242,255,.35);
      background: rgba(103,242,255,.07);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.35);
    }
    .pinDot.filled{ background: rgba(103,242,255,.28); box-shadow: 0 0 16px rgba(103,242,255,.18); }

    .hint{
      font-family:var(--sans);
      font-size:12px;
      opacity:.85;
      color: rgba(103,242,255,.85);
      text-align:center;
      margin-top:4px;
      white-space:pre-line;
    }

    .monoSmall{ font-size:12px; opacity:.95; }
    .muted{ color: rgba(103,242,255,.7); }
    .divider{ height:1px; background: var(--line2); margin:10px 0; }

    .barWrap{ border:1px solid rgba(103,242,255,.22); border-radius:10px; overflow:hidden; background: rgba(7,16,23,.35); }
    .bar{ height:14px; width:0%; background: linear-gradient(90deg, rgba(103,242,255,.2), rgba(103,242,255,.75)); box-shadow: 0 0 18px rgba(103,242,255,.25); }
    .okText{ color: var(--ok); font-weight:800; }

    ul{ margin:8px 0 0 0; padding-left:18px; }
    li{ margin:6px 0; }

    .navRow{ display:flex; gap:10px; margin-top:auto; }

    @media (max-width: 620px){
      .row{flex-direction:column}
      .kbd{max-width:100%}
      .pad{ aspect-ratio: 3/4.3; width:min(920px, 100%); } /* on very small screens, fallback */
    }
  </style>
</head>
<body>
  <div class="pad" id="pad">
    <div class="bezel"></div>
    <div class="screen" id="screen">
      <div class="noise"></div>
      <div class="glitchOverlay"></div>

      <div class="top">
        <div>
          <div class="title">DATAPAD // APOPHIS DELTA</div>
          <div class="sub" id="subtitle">SICHERHEITS-INTERFACE</div>
        </div>
        <div class="status">
          <div class="pill"><span class="dot"></span><span id="statusText">LINK STABIL</span></div>
        </div>
      </div>

      <div class="content" id="app"></div>
    </div>
  </div>

<script>
  const app = document.getElementById('app');
  const screen = document.getElementById('screen');
  const subtitle = document.getElementById('subtitle');
  const statusText = document.getElementById('statusText');

  const state = {
    view: 'pin',
    pin: '',
    pinError: '',
    hacked: false,
    doorOpened: false,
    lockUntil: 0
  };

  const views = {
    pin: renderPin,
    hack: renderHack,
    lock: renderLock,
    menu: renderMenu,
    doors: renderDoors,
    station: renderStation,
    sectors: renderSectors,
    anomaly: renderAnomaly,
    evac: renderEvac,
    auftrag: renderAuftrag,
  };

  function setView(v){ state.view = v; render(); }

  function render(){
    screen.classList.toggle('glitchOn', state.view === 'anomaly');

    // Per-view layout tweaks
    app.classList.toggle('noScroll', state.view === 'sectors');
    app.classList.toggle('compact', state.view === 'sectors');

    if(state.view === 'pin' || state.view === 'hack' || state.view === 'lock'){
      subtitle.textContent = 'ZUGANG GESPERRT';
      statusText.textContent = 'AUTH ERFORDERLICH';
    } else {
      subtitle.textContent = 'DR. ELYA VOSS // PRIVATES DATAPAD';
      statusText.textContent = state.hacked ? 'ZUGANG AKTIV' : 'EINGESCHRÄNKT';
    }

    app.innerHTML = '';
    views[state.view]();
  }

  function el(tag, cls, html){
    const n = document.createElement(tag);
    if(cls) n.className = cls;
    if(html !== undefined) n.innerHTML = html;
    return n;
  }

  function button(label, onClick, kind=''){
    const b = el('button', 'btn ' + (kind||''));
    b.type = 'button';
    b.textContent = label;
    b.addEventListener('click', onClick);
    return b;
  }

  function backButton(to='menu'){
    return button('← ZURÜCK', () => setView(to), 'secondary');
  }

  function flashStatus(text, isBad){
    const old = statusText.textContent;
    statusText.textContent = text;
    const pill = statusText.closest('.pill');
    const dot = pill ? pill.querySelector('.dot') : null;
    if(dot){
      dot.style.background = isBad ? 'var(--bad)' : 'var(--ok)';
      dot.style.boxShadow = isBad ? '0 0 14px rgba(255,107,107,.55)' : '0 0 14px rgba(124,255,178,.65)';
    }
    setTimeout(() => {
      statusText.textContent = old;
      if(dot){
        dot.style.background = 'var(--ok)';
        dot.style.boxShadow = '0 0 14px rgba(124,255,178,.65)';
      }
    }, 900);
  }

  // --- PIN page (always rejected) ---
  function renderPin(){
    const p = el('div','panel');
    p.appendChild(el('div','monoSmall muted','PIN-VERIFIKATION'));
    p.appendChild(el('div','divider'));

    const pinRow = el('div','pinbox');
    for(let i=0;i<4;i++) pinRow.appendChild(el('div','pinDot' + (state.pin.length>i ? ' filled':'')));
    p.appendChild(pinRow);

    const err = el('div','hint');
    err.style.color = 'rgba(255,107,107,.95)';
    err.style.fontWeight = '800';
    err.textContent = state.pinError || '';
    p.appendChild(err);

    p.appendChild(el('div','hint','PIN eingeben'));

    const k = el('div','kbd');
    const keys = ['1','2','3','4','5','6','7','8','9','⌫','0','↩'];
    keys.forEach(key => {
      const kd = el('div','key', key);
      kd.addEventListener('click', () => {
        state.pinError = '';
        if(key === '⌫'){ state.pin = state.pin.slice(0,-1); render(); return; }
        if(key === '↩'){ if(state.pin.length === 4) rejectPin(); return; }
        if(state.pin.length < 4 && /^[0-9]$/.test(key)){
          state.pin += key;
          render();
          if(state.pin.length === 4) setTimeout(rejectPin, 220);
        }
      });
      k.appendChild(kd);
    });
    p.appendChild(k);

    const actions = el('div','row');
    const left = el('div','col');
    left.appendChild(button('HACKING', () => {
      const now = Date.now();
      if(state.lockUntil && now < state.lockUntil) setView('lock');
      else setView('hack');
    }));

    const right = el('div','col');
    right.appendChild(button('PIN LÖSCHEN', () => { state.pin=''; state.pinError=''; render(); }, 'secondary'));

    actions.appendChild(left);
    actions.appendChild(right);

    app.appendChild(p);
    app.appendChild(actions);

    function rejectPin(){
      state.pinError = 'NICHT AUTORISIERT';
      flashStatus('AUTH VERWEIGERT', true);
      state.pin = '';
      render();
    }
  }

  // --- Hacking result chooser ---
  function renderHack(){
    const p = el('div','panel');
    p.appendChild(el('div','monoSmall muted','HACKING-MODUS'));
    p.appendChild(el('div','divider'));

    p.appendChild(el('div','monoSmall','Nutze deinen Wurf am Tisch und wähle das Ergebnis:'));
    // IMPORTANT: avoid raw newlines in single-quoted JS strings (was causing the SyntaxError)
    p.appendChild(el('div','hint',
      '• ERFOLGREICH: Zugriff auf Übersicht\n• FEHLGESCHLAGEN: 5-Minuten-Sperre'
    ));

    const g = el('div','grid');
    g.style.gridTemplateColumns = 'repeat(2, 1fr)';

    g.appendChild(button('HACKING ERFOLGREICH', () => {
      state.hacked = true;
      setView('menu');
    }));

    g.appendChild(button('HACKING FEHLGESCHLAGEN', () => {
      state.hacked = false;
      state.lockUntil = Date.now() + 5*60*1000;
      setView('lock');
    }, 'secondary'));

    p.appendChild(el('div','divider'));
    p.appendChild(g);

    const nav = el('div','navRow');
    nav.appendChild(backButton('pin'));
    app.appendChild(p);
    app.appendChild(nav);
  }

  // --- Lockout screen ---
  function renderLock(){
    const p = el('div','panel');
    p.appendChild(el('div','monoSmall muted','SICHERHEITS-SPERRE'));
    p.appendChild(el('div','divider'));

    const t = el('div','monoSmall');
    t.innerHTML = '<div><span class="muted">STATUS:</span> ZU VIELE FEHLVERSUCHE</div>';
    p.appendChild(t);

    const timerLine = el('div','hint');
    timerLine.style.fontFamily = 'var(--mono)';
    timerLine.style.fontSize = '14px';
    timerLine.style.fontWeight = '800';
    timerLine.style.marginTop = '10px';
    p.appendChild(timerLine);

    const nav = el('div','navRow');
    nav.appendChild(backButton('pin'));

    app.appendChild(p);
    app.appendChild(nav);

    const interval = setInterval(() => {
      const now = Date.now();
      const left = Math.max(0, state.lockUntil - now);
      const mm = String(Math.floor(left/60000)).padStart(2,'0');
      const ss = String(Math.floor((left%60000)/1000)).padStart(2,'0');
      timerLine.textContent = left > 0 ? `NEUER VERSUCH IN: ${mm}:${ss}` : 'SPERRE AUFGEHOBEN';
      if(left <= 0){ state.lockUntil = 0; clearInterval(interval); }
    }, 250);

    // initial tick
    (function(){
      const now = Date.now();
      const left = Math.max(0, state.lockUntil - now);
      const mm = String(Math.floor(left/60000)).padStart(2,'0');
      const ss = String(Math.floor((left%60000)/1000)).padStart(2,'0');
      timerLine.textContent = left > 0 ? `NEUER VERSUCH IN: ${mm}:${ss}` : 'SPERRE AUFGEHOBEN';
    })();
  }

  // --- Menu ---
  function renderMenu(){
    const p = el('div','panel');
    p.appendChild(el('div','monoSmall muted','ÜBERSICHT'));
    p.appendChild(el('div','divider'));

    const info = el('div','monoSmall');
    info.innerHTML = `
      <div><span class="muted">STATION:</span> APOPHIS DELTA</div>
      <div><span class="muted">GPS:</span> <span style="color: rgba(255,107,107,.95); font-weight:800;">FEHLER // POSITION UNBEKANNT</span></div>
      <div><span class="muted">STATUS:</span> QUARANTÄNE / TEILWEISE NOTSTROM</div>
    `;
    p.appendChild(info);

    // Emergency banner/button (red + blinking)
    const alertWrap = el('div','panel');
    alertWrap.style.borderColor = 'rgba(255,107,107,.35)';
    alertWrap.style.background = 'rgba(60,10,10,.22)';

    const alertTop = el('div','monoSmall');
    alertTop.innerHTML = `<span style="font-weight:900; letter-spacing:.08em;">NOTEVAKUIERUNG</span><span class="alertTag">ALARM</span>`;
    const alertHint = el('div','hint','Sammelpunkte werden neu priorisiert. Öffne den Notfallhinweis.');
    const alertBtn = button('NOTEVAKUIERUNG ÖFFNEN', () => setView('evac'));
    alertBtn.classList.add('alertBtn');

    alertWrap.appendChild(alertTop);
    alertWrap.appendChild(alertHint);
    alertWrap.appendChild(el('div','divider'));
    alertWrap.appendChild(alertBtn);

    // Navigation buttons
    const g = el('div','grid2');
    g.appendChild(button('TÜR-STEUERUNG', () => setView('doors')));
    g.appendChild(button('STATIONSINFORMATION', () => setView('station')));
    g.appendChild(button('SEKTOREN', () => setView('sectors')));
    g.appendChild(button('ANOMALIE-LOG', () => setView('anomaly')));
    g.appendChild(button('AUFTRAG', () => setView('auftrag')));

    // Layout: two columns to fill landscape nicely
    const wrap = el('div','row');
    const left = el('div','col');
    const right = el('div','col');

    left.appendChild(alertWrap);

    const navPanel = el('div','panel');
    navPanel.appendChild(el('div','monoSmall muted','NAVIGATION'));
    navPanel.appendChild(el('div','divider'));
    navPanel.appendChild(g);
    right.appendChild(navPanel);

    wrap.appendChild(left);
    wrap.appendChild(right);

    p.appendChild(el('div','divider'));
    p.appendChild(wrap);

    const nav = el('div','navRow');
    nav.appendChild(button('ABMELDEN', () => {
      state.pin='';
      state.pinError='';
      state.hacked=false;
      setView('pin');
    }, 'secondary'));

    app.appendChild(p);
    app.appendChild(nav);
  }

  // --- Door control (~10s) ---
  function renderDoors(){
    const p = el('div','panel');
    p.appendChild(el('div','monoSmall muted','TÜR-STEUERUNG'));
    p.appendChild(el('div','divider'));

    const desc = el('div','monoSmall');
    desc.innerHTML = `
      <div><span class="muted">ZIEL:</span> DOCK-INNENSCHOTT // OVERRIDE</div>
      <div><span class="muted">MODUS:</span> LOKALER NOTFALLZUGRIFF</div>
    `;
    p.appendChild(desc);

    p.appendChild(el('div','divider'));

    const barWrap = el('div','barWrap');
    const bar = el('div','bar');
    barWrap.appendChild(bar);
    p.appendChild(barWrap);

    const line = el('div','hint','VERARBEITUNG…');
    p.appendChild(line);

    const openText = el('div','hint okText');

    let pct = 0;
    state.doorOpened = false;

    const timer = setInterval(() => {
      const jitter = (Math.random() - 0.5) * 0.25;
      pct += 1 + jitter; // ~1% per 100ms => ~10s
      if(pct >= 100){
        pct = 100;
        bar.style.width = pct + '%';
        clearInterval(timer);
        state.doorOpened = true;
        line.textContent = 'STATUS:';
        openText.textContent = 'TÜR GEÖFFNET';
        p.appendChild(openText);
      } else {
        bar.style.width = Math.max(0, pct) + '%';
      }
    }, 100);

    const nav = el('div','navRow');
    nav.appendChild(backButton('menu'));

    app.appendChild(p);
    app.appendChild(nav);
  }

  // --- Station info ---
  function renderStation(){
    const p = el('div','panel');
    p.appendChild(el('div','monoSmall muted','STATIONSINFORMATION'));
    p.appendChild(el('div','divider'));

    const ul = el('ul','monoSmall');
    ul.innerHTML = `
      <li><b>Apophis Delta</b> – Forschungsstation (Orbitalplattform), modulare Ringstruktur.</li>
      <li>Primärbereiche: Forschung, Sicherheit, Zivil – verbunden über Service-Spine & Wartungsachsen.</li>
      <li>Schwerkraft: 1g nominal; Magnetleisten in Servicegängen bei Notbetrieb.</li>
      <li>Umwelt: Standarddruck 1 atm; Temperatur 21°C; Feuchte 35% (autom. Regulierung).</li>
      <li>Versorgung: Wasser-Recycling 93%; O2-Reserve ~36h bei Normalbelegung.</li>
      <li>Kommunikation: Lokaler Funk stabil; Langstreckenlink priorisiert für Notrufpakete.</li>
      <li>Dockbetrieb: Wartungsfenster 08:00–20:00 (Stationszeit); Frachtdrohnen aktiv.</li>
      <li>Interne Hinweise: Bitte Laufwege freihalten – Mikrodrohnen im Reparaturmodus.</li>
      <li>Kantine (Rotation): Synth-Eintopf / Algenbrot / Kaffeeersatz. Allergene: "Spirulina".</li>
      <li>Freizeit: Holoschach, Blickkuppel, leiser Fitnessraum (nur Zivilring).</li>
    `;
    p.appendChild(ul);

    p.appendChild(el('div','divider'));
    p.appendChild(el('div','monoSmall muted','EIGENTÜMER-VERMERK'));
    p.appendChild(el('div','monoSmall','Dieses DataPad ist als persönliches Gerät von <b>Dr. Elya Voss</b> registriert.'));

    p.appendChild(el('div','divider'));
    p.appendChild(el('div','monoSmall muted','BASIS-HINWEISE'));
    p.appendChild(el('div','monoSmall','• Unbefugte Nutzung von Sicherheits-Terminals kann automatische Sperren auslösen.'));
    p.appendChild(el('div','monoSmall','• Evakuierungspunkte werden dynamisch neu priorisiert.'));
    p.appendChild(el('div','monoSmall','• Bitte melden: defekte Schotts, flackernde Bodenleisten, ungewöhnliche Interferenz.'));

    const nav = el('div','navRow');
    nav.appendChild(backButton('menu'));
    app.appendChild(p);
    app.appendChild(nav);
  }

  // --- Sectors ---
  function renderSectors(){
    // One-screen sectors schematic (no extra markers/dots).
    const p = el('div','panel');
    p.style.display = 'flex';
    p.style.flexDirection = 'column';
    p.style.gap = '8px';
    p.style.height = '100%';

    // Header row
    const headRow = el('div','row');
    headRow.style.alignItems = 'center';
    headRow.style.gap = '10px';

    const headLeft = el('div','col');
    headLeft.appendChild(el('div','monoSmall muted','SEKTOREN // ÜBERSICHT'));

    const headRight = el('div','col');
    headRight.style.display = 'flex';
    headRight.style.justifyContent = 'flex-end';
    const back = backButton('menu');
    back.style.maxWidth = '220px';
    headRight.appendChild(back);

    headRow.appendChild(headLeft);
    headRow.appendChild(headRight);
    p.appendChild(headRow);

    // Map container
    const map = el('div','panel');
    map.style.background = 'rgba(7,16,23,.35)';
    map.style.borderColor = 'rgba(103,242,255,.18)';
    map.style.padding = '8px';
    map.style.flex = '1 1 auto';
    map.style.display = 'flex';
    map.style.alignItems = 'center';
    map.style.justifyContent = 'center';
    map.style.overflow = 'hidden';

    // Clean schematic: Dockbucht 8 -> (Forschung / Sicherheit / Zivil) -> Knotenpunkt -> Hangar 9
    // Removed any small node markers/dots; only the main Knoten is a circle.
    map.innerHTML = `
      <svg viewBox="0 0 1000 520" width="100%" height="100%" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
        <!-- subtle frame -->
        <rect x="10" y="10" width="980" height="500" rx="18" fill="rgba(0,0,0,.10)" stroke="rgba(103,242,255,.16)"/>

        <!-- nodes / boxes -->
        <g font-family="ui-monospace, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace" fill="rgba(103,242,255,.96)">
          <!-- Dock -->
          <rect x="60" y="215" width="220" height="90" rx="16" fill="rgba(7,16,23,.60)" stroke="rgba(103,242,255,.55)" stroke-width="2"/>
          <text x="85" y="250" font-size="22" font-weight="800" letter-spacing="1">DOCKBUCHT 8</text>

          <!-- Forschung -->
          <rect x="360" y="85" width="220" height="90" rx="16" fill="rgba(7,16,23,.55)" stroke="rgba(103,242,255,.35)" stroke-width="2"/>
          <text x="388" y="122" font-size="19" font-weight="800">FORSCHUNG</text>
          <text x="388" y="148" font-size="13" opacity=".82">Labore / Analyse</text>

          <!-- Sicherheit -->
          <rect x="360" y="215" width="220" height="90" rx="16" fill="rgba(7,16,23,.55)" stroke="rgba(103,242,255,.35)" stroke-width="2"/>
          <text x="388" y="252" font-size="19" font-weight="800">SICHERHEIT</text>
          <text x="388" y="278" font-size="13" opacity=".82">Kontrolle / Zellen</text>

          <!-- Zivil -->
          <rect x="360" y="345" width="220" height="90" rx="16" fill="rgba(7,16,23,.55)" stroke="rgba(103,242,255,.35)" stroke-width="2"/>
          <text x="388" y="382" font-size="19" font-weight="800">ZIVIL</text>
          <text x="388" y="408" font-size="13" opacity=".82">Quartiere / Kantine</text>

          <!-- Knoten -->
          <circle cx="735" cy="260" r="58" fill="rgba(7,16,23,.58)" stroke="rgba(103,242,255,.55)" stroke-width="2"/>
          <text x="697" y="255" font-size="20" font-weight="900">KNOTEN</text>

          <!-- Hangar -->
          <rect x="875" y="215" width="100" height="90" rx="16" fill="rgba(7,16,23,.60)" stroke="rgba(103,242,255,.55)" stroke-width="2"/>
          <text x="892" y="248" font-size="18" font-weight="900">HANGAR</text>
          <text x="918" y="280" font-size="28" font-weight="900" opacity=".95">9</text>
        </g>

        <!-- connection lines ON TOP so they can never disappear -->
        <g stroke="rgba(103,242,255,.85)" stroke-width="10" stroke-linecap="round" stroke-linejoin="round" opacity="1" fill="none">
          <!-- Dock -> Sektoren (90°-Routen) -->
          <path d="M280 260 L320 260 L320 130 L360 130"/>
          <path d="M280 260 L360 260"/>
          <path d="M280 260 L320 260 L320 390 L360 390"/>

          <!-- Sektoren -> Knoten (90°-Routen) -->
          <path d="M580 130 L640 130 L640 260 L677 260"/>
          <path d="M580 260 L677 260"/>
          <path d="M580 390 L640 390 L640 260 L677 260"/>

          <!-- Knoten -> Hangar 9 (kurzer Knick für Plan-Optik) -->
          <path d="M793 260 L835 260 L835 260 L875 260"/>
        </g>
      </svg>
    `;

    // Make sure it fills the available space in landscape.
    map.style.minHeight = '320px';

    p.appendChild(map);
    app.appendChild(p);
  }

  // --- Anomaly log ---
  function renderAnomaly(){
    const p = el('div','panel');
    p.appendChild(el('div','monoSmall muted','ANOMALIE-LOG'));
    p.appendChild(el('div','divider'));

    const block = el('div','panel');
    block.style.background = 'rgba(0,0,0,.18)';
    block.style.borderColor = 'rgba(103,242,255,.18)';

    block.innerHTML = `
      <div class="monoSmall" style="letter-spacing:.06em; font-weight:800;">ANOMALIE:</div>
      <ul class="monoSmall" style="margin-top:10px;">
        <li>!$§&amp; IZZX #~6$</li>
        <li>!,?,% EXPAN&lt;ION</li>
        <li>ENERGIE-WEELLEN</li>
        <li>SCHATTEN *@P06%LLATEG</li>
        <li>ZERS*RR-&amp;$%6UNG~</li>
      </ul>
      <div class="divider"></div>
      <div class="monoSmall"><span class="muted">FILTER</span>  ++++  / PROTOKOLL? #6</div>
      <div class="divider"></div>
      <div class="monoSmall" style="font-weight:800;">DIAGNOSTIK:</div>
      <div class="monoSmall" style="margin-top:8px; line-height:1.4;">
        Zzzzr6!^^]]] aufrechter Kompetenz%exchatten-Riss …<br/>
        %cu/6uge% instabil &amp; *#AN*^AM@ da#%x$&amp;Üm.&amp;in$el:<br/>
        Struke$$6 drohende Verzehrung, Ch&amp;zz,%,!!6efahr!<br/>
        $6a&amp;G6&gt;&gt;-
      </div>
    `;

    p.appendChild(block);
    p.appendChild(el('div','hint','Hinweis: Teile des Logs sind beschädigt. Nur Fragmente bleiben stabil.'));

    const nav = el('div','navRow');
    nav.appendChild(backButton('menu'));
    app.appendChild(p);
    app.appendChild(nav);
  }

  function renderEvac(){
    const p = el('div','panel');
    p.style.borderColor = 'rgba(255,107,107,.35)';
    p.style.background = 'rgba(60,10,10,.22)';

    p.appendChild(el('div','monoSmall muted','NOTEVAKUIERUNG'));
    p.appendChild(el('div','divider'));

    const block = el('div','panel');
    block.style.borderColor = 'rgba(255,107,107,.35)';
    block.style.background = 'rgba(20,4,4,.35)';

    block.innerHTML = `
      <div class="monoSmall" style="font-weight:900; letter-spacing:.08em; color:#ffd6d6;">ALARMSTUFE: ROT</div>
      <div class="divider"></div>
      <div class="monoSmall" style="line-height:1.55; color:#ffd6d6;">
        • Evakuierungsrouten werden dynamisch neu berechnet.<br/>
        • Quarantäne-Schotts können Wege blockieren.<br/>
        • Sammelpunkte: Priorität A (Verletzte, Kinder, Hilfskräfte).<br/>
        • Funk: Kurzstrecke bevorzugt. Langstrecke kann ausfallen.<br/>
        • Bleiben Sie in Gruppen. Vermeiden Sie unmarkierte Wartungsachsen, falls möglich.<br/>
      </div>
      <div class="divider"></div>
      <div class="monoSmall" style="font-weight:900; color:#fff0f0;">ZIELVORGABE:</div>
      <div class="monoSmall" style="margin-top:8px; line-height:1.55; color:#fff0f0;">
        Begeben Sie sich zur <b>EVAKUIERUNGSPLATTFORM</b>.<br/>
        Primärer Sammelpunkt: <b>HANGAR 9</b>.<br/>
        <span style="color:#ffcc66; font-weight:800;">Hinweis:</span> Das Evakuierungsschiff befindet sich im <b>Hangar 9</b>.
      </div>
      <div class="divider"></div>
      <div class="hint" style="color: rgba(255,214,214,.9);">Wenn GPS ausfällt: Nutzen Sie Sektor-Schilder, Pfeile an Deckenleisten und Service-Spine-Markierungen.</div>
    `;

    p.appendChild(block);

    const nav = el('div','navRow');
    nav.appendChild(backButton('menu'));
    app.appendChild(p);
    app.appendChild(nav);
  }

  function renderAuftrag(){
    const p = el('div','panel');
    p.appendChild(el('div','monoSmall muted','AUFTRAG // TRANSFERANFRAGE'));
    p.appendChild(el('div','divider'));

    const block = el('div','panel');
    block.style.borderColor = 'rgba(103,242,255,.22)';
    block.style.background = 'rgba(0,0,0,.14)';

    block.innerHTML = `
      <div class="monoSmall" style="font-weight:900; letter-spacing:.06em;">VERTRAG: BIO-TRANSFER (STUFE C)</div>
      <div class="divider"></div>

      <div class="monoSmall" style="line-height:1.55;">
        <b>Gegenstand:</b> Humanoider Androiden-Körper (Status: <span class="muted">tot</span>)<br/>
        <b>Abholpunkt:</b> Dockbucht 8 (lokale Referenz) &nbsp;|&nbsp; <b>Übergabe:</b> Quarantäne-Schleuse<br/>
        <b>Ident.-Bezeichn.:</b> NU/UM-Δ (unklassifiziert) &nbsp;|&nbsp; <b>Handhabung:</b> gekühlt / stabilisiert<br/>
      </div>

      <div class="divider"></div>

      <div class="monoSmall" style="line-height:1.55;">
        <b>Kaufpreis (vereinbart):</b> 1.000 Credits<br/>
        <b>Auszahlung:</b> 50% bei Übergabe, 50% nach Eingangskontrolle<br/>
        <b>Bonus Vermittler:</b> 300 Credits<br/>
        <b>Vermittler:</b> "Dr. Voss" (Weiterleitung zu Forschungslabor)
      </div>

      <div class="divider"></div>

      <div class="monoSmall" style="line-height:1.55;">
        <b>Hinweis (intern):</b> Bitte keine Fragen zu Herkunft / Vorfällen stellen. Dokumentation wird zentral geführt.<br/>
        <b>Messwert:</b> <span class="muted">Anomali-Kohärenz</span> erhöht (lokale Sensorik) – weitere Details nicht verfügbar.<br/>
        <b>Voss-Notiz:</b> "Ich liefere nur. Das Labor will Zahlen. Ich habe keine vollständige Freigabe."<br/>
      </div>

      <div class="divider"></div>
      <div class="hint">Dieser Eintrag wirkt wie ein standardisierter Beschaffungsauftrag mit lückenhaften Metadaten.</div>
    `;

    p.appendChild(block);

    const nav = el('div','navRow');
    nav.appendChild(backButton('menu'));
    app.appendChild(p);
    app.appendChild(nav);
  }

  // --- Minimal self-tests (run only when ?test=1) ---
  (function runTests(){
    const params = new URLSearchParams(location.search);
    if(params.get('test') !== '1') return;
    console.group('DataPad self-tests');
    try{
      console.assert(typeof renderPin === 'function', 'renderPin exists');
      console.assert(typeof renderSectors === 'function', 'renderSectors exists');
      console.assert(typeof renderEvac === 'function', 'renderEvac exists');
      console.assert(typeof renderAuftrag === 'function', 'renderAuftrag exists');
      // Render sectors once to ensure no template literal/SVG issues
      const prev = state.view;
      setView('sectors');
      console.assert(app.innerHTML.includes('svg'), 'Sectors includes SVG');
      setView('evac');
      console.assert(app.textContent.includes('HANGAR 9'), 'Evac mentions Hangar 9');
      setView('auftrag');
      console.assert(app.textContent.includes('Kaufpreis'), 'Auftrag shows purchase info');
      setView(prev);
      console.log('OK');
    } catch (e){
      console.error('Tests failed', e);
    }
    console.groupEnd();
  })();

  render();
</script>
</body>
</html>
